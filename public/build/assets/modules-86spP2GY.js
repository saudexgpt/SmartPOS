import{a as _,b as i}from"./bootstrap-DN_KIGH5.js";import{_ as f}from"./currency-gBUix5n2.js";import{j as w,_ as M,v as k}from"./print-DOU-TAfv.js";import{d as C}from"./ns-prompt-popup-CDVMGRH6.js";import"./index.es-BamOKBrQ.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as P,o as c,c as u,b as e,t as n,C as E,f as x,F as N,e as B,j as p,h as v,w as b,g}from"./runtime-core.esm-bundler-DDZT2pc5.js";import"./chart-Ozef1QaY.js";const D={name:"ns-modules",props:["url","upload"],data(){return{rawModules:[],searchPlaceholder:f('Press "/" to search modules'),total_enabled:0,total_disabled:0,searchText:"",searchTimeOut:null}},mounted(){this.loadModules().subscribe(),document.addEventListener("keypress",s=>{s.key==="/"&&this.$refs.searchField!==null&&setTimeout(()=>{this.$refs.searchField.select()},1)})},watch:{},computed:{noModules(){return Object.values(this.modules).length===0},modules(){if(this.searchText.length>0){const s=Object.values(this.rawModules).filter(o=>{const a=new RegExp(this.searchText,"gi"),d=o.name.match(a);return d!==null?d.length>0:!1}),t=new Object;for(let o=0;o<s.length;o++)t[s[o].namespace]=s[o];return t}return this.rawModules},noModuleMessage(){return f("No module has been uploaded yet.")}},methods:{__:f,openPopupDetails(s){w.show(C,{title:f("{module}").replace("{module}",s.name),message:s.description})},download(s){document.location="/dashboard/modules/download/"+s.namespace},performMigration:async(s,t)=>{const o=async(a,d)=>new Promise((l,h)=>{_.post(`/api/modules/${s.namespace}/migrate`,{file:a,version:d}).subscribe({next:r=>{l(!0)},error:r=>i.error(r.message,null,{duration:4e3}).subscribe()})});if(t=t||s.migrations,t){s.migrating=!0;for(let a in t)for(let d=0;d<t[a].length;d++){const l=t[a][d];await o(l,a)}s.migrating=!1,s.migrated=!0}},truncateText(s,t,o="..."){let a=s.split(" ");return a.length>t&&(a=a.slice(0,t),a.push(o)),a.join(" ")},countWords(s){return s.split(" ").length},refreshModules(){this.loadModules().subscribe()},enableModule(s){const t=`${this.url}/${s.namespace}/enable`;_.put(t).subscribe({next:async o=>{i.success(o.message).subscribe(),this.loadModules().subscribe({next:a=>{document.location.reload()},error:a=>{i.error(a.message).subscribe()}})},error:o=>{i.error(o.message).subscribe()}})},disableModule(s){const t=`${this.url}/${s.namespace}/disable`;_.put(t).subscribe({next:o=>{i.success(o.message).subscribe(),this.loadModules().subscribe({next:a=>{document.location.reload()},error:a=>{i.error(a.message).subscribe()}})},error:o=>{i.error(o.message).subscribe()}})},loadModules(){return _.get(this.url).pipe(M(s=>(this.rawModules=s.modules,this.total_enabled=s.total_enabled,this.total_disabled=s.total_disabled,s)))},removeModule(s){if(confirm(f('Would you like to delete "{module}"? All data created by the module might also be deleted.').replace("{module}",s.name))){const t=`${this.url}/${s.namespace}/delete`;_.delete(t).subscribe({next:o=>{this.loadModules().subscribe({next:a=>{document.location.reload()}})},error:o=>{i.error(o.message,null,{duration:5e3}).subscribe()}})}}}},F={id:"module-wrapper",class:"flex-auto flex flex-col pb-4"},V={class:"flex flex-col md:flex-row md:justify-between md:items-center"},R={class:"flex flex-col md:flex-row md:justify-between md:items-center -mx-2"},W={class:"px-2"},A={class:"ns-button mb-2"},S={class:"mx-2"},U={class:"px-2"},j={class:"ns-button mb-2"},H=["href"],L={class:"px-2 w-auto"},q={class:"input-group mb-2 shadow border-2 info rounded overflow-hidden"},z=["placeholder"],G={class:"header-tabs flex -mx-4 flex-wrap"},I={class:"px-4 text-xs text-blue-500 font-semibold hover:underline"},J={href:"#"},K={class:"px-4 text-xs text-blue-500 font-semibold hover:underline"},Q={href:"#"},X={class:"module-section flex-auto flex flex-wrap -mx-4"},Y={key:0,class:"p-4 flex-auto flex"},Z={class:"flex h-full flex-auto border-dashed border-2 border-box-edge bg-surface justify-center items-center"},$={class:"font-bold text-xl text-primary text-center"},O={key:1,class:"p-4 flex-auto flex"},ee={class:"flex h-full flex-auto border-dashed border-2 border-box-edge bg-surface justify-center items-center"},se={class:"font-bold text-xl text-primary text-center"},te={class:"ns-modules rounded shadow overflow-hidden ns-box"},le={class:"module-head h-32 p-2"},oe={class:"font-semibold text-lg"},re={class:"text-xs flex justify-between"},ae={class:"py-2 text-sm"},de=["onClick"],ne={class:"ns-box-footer border-t p-2 flex justify-between"},ie={class:"flex -mx-1"},ce={class:"px-1 flex -mx-1"},ue={class:"px-1 flex"},he={class:"px-1 flex"};function _e(s,t,o,a,d,l){const h=P("ns-button");return c(),u("div",F,[e("div",V,[e("div",R,[e("span",W,[e("div",A,[e("a",{onClick:t[0]||(t[0]=r=>l.refreshModules()),class:"items-center justify-center rounded cursor-pointer shadow flex px-3 py-1"},[t[2]||(t[2]=e("i",{class:"las la-sync"},null,-1)),e("span",S,n(l.__("Refresh")),1)])])]),e("span",U,[e("div",j,[e("a",{href:o.upload,class:"flex items-center justify-center rounded cursor-pointer shadow px-3 py-1"},[e("span",null,n(l.__("Upload")),1),t[3]||(t[3]=e("i",{class:"las la-angle-right"},null,-1))],8,H)])]),e("div",L,[e("div",q,[E(e("input",{ref:"searchField",placeholder:d.searchPlaceholder,"onUpdate:modelValue":t[1]||(t[1]=r=>d.searchText=r),type:"text",class:"w-full md:w-60 outline-none py-1 px-2"},null,8,z),[[k,d.searchText]])])])]),e("div",G,[e("div",I,[e("a",J,n(l.__("Enabled"))+"("+n(d.total_enabled)+")",1)]),e("div",K,[e("a",Q,n(l.__("Disabled"))+" ("+n(d.total_disabled)+")",1)])])]),e("div",X,[l.noModules&&d.searchText.length===0?(c(),u("div",Y,[e("div",Z,[e("h2",$,n(l.noModuleMessage),1)])])):x("",!0),l.noModules&&d.searchText.length>0?(c(),u("div",O,[e("div",ee,[e("h2",se,n(l.__("No modules matches your search term.")),1)])])):x("",!0),(c(!0),u(N,null,B(l.modules,(r,y)=>(c(),u("div",{class:"px-4 w-full md:w-1/2 lg:w-1/3 xl:1/4 py-4",key:y},[e("div",te,[e("div",le,[e("h3",oe,n(r.name),1),e("p",re,[e("span",null,n(r.author),1),e("strong",null,"v"+n(r.version),1)]),e("p",ae,[p(n(l.truncateText(r.description,20,"..."))+" ",1),l.countWords(r.description)>20?(c(),u("a",{key:0,class:"text-xs text-info-tertiary hover:underline",onClick:m=>l.openPopupDetails(r),href:"javascript:void(0)"},"["+n(l.__("Read More"))+"]",9,de)):x("",!0)])]),e("div",ne,[r.enabled?x("",!0):(c(),v(h,{key:0,disabled:r.autoloaded,onClick:m=>l.enableModule(r),type:"info"},{default:b(()=>[p(n(l.__("Enable")),1)]),_:2},1032,["disabled","onClick"])),r.enabled?(c(),v(h,{key:1,disabled:r.autoloaded,onClick:m=>l.disableModule(r),type:"success"},{default:b(()=>[p(n(l.__("Disable")),1)]),_:2},1032,["disabled","onClick"])):x("",!0),e("div",ie,[e("div",ce,[e("div",ue,[g(h,{disabled:r.autoloaded,onClick:m=>l.download(r),type:"info"},{default:b(()=>t[4]||(t[4]=[e("i",{class:"las la-archive"},null,-1)])),_:2},1032,["disabled","onClick"])]),e("div",he,[g(h,{disabled:r.autoloaded,onClick:m=>l.removeModule(r),type:"error"},{default:b(()=>t[5]||(t[5]=[e("i",{class:"las la-trash"},null,-1)])),_:2},1032,["disabled","onClick"])])])])])])]))),128))])])}const we=T(D,[["render",_e]]);export{we as default};
